:imagesdir: ../../images/patterns/criacionais
:source-highlighter: highlightjs
:numbered:
:unsafe:
:icons: font

ifdef::env-github[]
:outfilesuffix: .adoc
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
endif::[]

= Padr√µes de Projetos Criacionais

IMPORTANT: https://www.youtube.com/watch?v=VgDZsSMjmcU&list=PLyo0RUAM69UtO8Jjq71qgvRxcI2pTrB2m&index=9[V√≠deo-aulas dispon√≠veis aqui.]

== Singleton

image:lonely-2378396_1280.jpg[]

=== Defini√ß√£o

// tag::definicao[]
üìò"Garante que uma classe tenha apenas uma inst√¢ncia e fornece um ponto global de acesso a ela." [UCPP]
// end::definicao[]

=== Aplicabilidade

Este √© um padr√£o aplicado em casos excepcionais.

// tag::aplicabilidade[]
- Quando precisa-se garantir que uma classe tenha uma √∫nica inst√¢ncia durante toda a execu√ß√£o da app;
- o objeto a ser criado possui dados √∫nicos, compartilhados por todos os usu√°rios da app;
- tal objeto exige muitos recursos (como mem√≥ria) ou tem alto custo de instancia√ß√£o;
- representa um dispositivo f√≠sico pro qual n√£o faz sentido ter duas inst√¢ncia dentro da mesma app (como uma impresora).
// end::aplicabilidade[]

=== Modelagem

O padr√£o Singleton √© representado por uma √∫nica classe como apresentado na figura a seguir.

.Modelagem de uma classe que implementa o padr√£o Singleton
image::singleton.png[]

O padr√£o Singleton √© aplicado a uma classe por vez. 
A classe Singleton ser√° aquela que desejamos aplicar o padr√£o, logo,
normalmente √© uma classe que j√° existe e que apenas queremos impedir
que sejam criadas m√∫ltiplas inst√¢ncias dela.
Assim, n√£o teremos de fato uma classe chamada Singleton,
mas qualquer outro nome relacionado ao sistema que estamos desenvolvendo.

O que faz com que a classe tenha apenas uma √∫nica inst√¢ncia, √© armazenar tal inst√¢ncia
em um atributo est√°tico e privado dentro da pr√≥pria classe. Normalmente tal atributo √© chamado
simplesmente de `instance`. O tipo dele ser√° a pr√≥pria classe onde ele est√° sendo declarado.
Se tivermos uma classe Singleton `ImpressoraFiscal`, ela ter√° um atributo `ImpressoraFiscal instance`.

O m√©todo `getInstance()` deve retornar a inst√¢ncia armazenada no atributo `instance`,
logo, o tipo do retorno de tal m√©todo √© a pr√≥pria classe. No exemplo acima, ser√° `ImpressoraFiscal`.
Ele √© um m√©todo est√°tico, uma vez que n√£o devemos cham√°-lo a partir de uma inst√¢ncia, mas sim a partir
da classe para que o m√©todo retorne a inst√¢ncia.

Um detalhe importante √© que o construtor deve ser privado. Isto √© o principal para garantir que
uma √∫nica inst√¢ncia da classe ser√° criada.
Para obter-se a inst√¢ncia √∫nica, devemos chamar o m√©todo `getInstance()`, j√° que n√£o temos
como usar o construtor fora da classe.

Um projeto de exemplo para o diagrama apresentado est√° dispon√≠vel link:modelagem[aqui]. Este √© uma exemplo pr√°tico que implementa o padr√£o Singleton para classe que simula a comunica√ß√£o com uma impressora fiscal.

=== Princ√≠pios utilizados

Voc√™ poderia imaginar que o Singleton adere ao *Single*-Responsitility Principle (https://en.wikipedia.org/wiki/Single-responsibility_principle[SRP]), mas ele n√£o garante que a classe ter√° uma √∫nica responsabilidade. Ele garante que a classe ter√° uma √∫nica inst√¢ncia. Um padr√£o pode propiciar o SRP, no entanto est√° mais nas m√£os do desenvolvedor garantir um princ√≠pio que do padr√£o.

Pelo fato do padr√£o ser t√£o simples que sua modelagem √© uma √∫nica classe, ele n√£o adere a nenhum princ√≠pio espec√≠fico, mas apenas resolve um problema recorrente em desenvolvimento de software.

=== Exemplos

Um sistema pode ter um conjunto de configura√ß√µes que o usu√°rio pode alterar.
Considere que as configura√ß√µes do sistema podem ser acessadas e alteradas em diversos locais. Neste caso, o mais apropriado √© criar uma classe, chamada por exemplo de `Config`, que encapsula o gerenciamento de tais configura√ß√µes. Se instanciarmos objetos da classe `Config` em diferentes locais e alterarmos as configura√ß√µes, podemos ver os valores atualizados em determinados locais, enquanto aparecem desatualizados em outros. Isto pode trazer problemas para o sistema.

Neste caso, podemos aplicar o padr√£o Singleton √† classe `Config` para permitir que uma √∫nica inst√¢ncia dela seja criada para todo o sistema. 
Mesmo que tenhamos diversas vari√°veis `Config` espalhadas pelo sistema, todas apontar√£o para um √∫nico objeto criado. 
Assim, ao alterar uma configura√ß√£o por meio de qualquer dessas vari√°veis, estaremos alterando o mesmo objeto. 
Logo, teremos acesso aos mesmos dados, independetemente de qual vari√°vel utilizarmos.

A figura abaixo apresenta a modelagem para a classe `Config` implementado o padr√£o Singleton.

.Modelagem de uma classe que implementa o padr√£o Singleton para gerenciamento de configura√ß√µes de um sistema
image::singleton-config.png[]

O projeto link:config-singleton-spring[config-singleton-spring] (link:https://kinolien.github.io/gitzip/?download=/manoelcampos/padroes-projetos/tree/master/criacionais/singleton/config-singleton-spring[zip]) 
fornece a estrutura de um backend com Spring que aplica o padr√£o Singleton para a classe Config e por padr√£o para qualquer
Spring Bean (objetos cujo ciclo de vida √© controlado pelo Spring, como Controllers e Repositories).

=== Detalhes de Implementa√ß√£o

Para implementar o padr√£o Singleton, sempre tenha em mente os seguintes detalhes,
conforme pode ser observado na Figura 1 acima.

- Deve-se explicitamente definir um construtor privado para a classe Singleton. Em java, se nenhum construtor for definido, o compilador automaticamente incluir√° um construtor padr√£o p√∫blico, que permitir√° que a classe seja instanciada de qualquer lugar, quantas vezes desejarmos. Isto vai totalmente contra o padr√£o Singleton.
- A √∫nica inst√¢ncia a ser criada deve ser definida como um atributo privado e est√°tico. Como ele √© est√°tico, s√≥ haver√° uma √∫nica inst√¢ncia armazenada dentro da pr√≥pria classe. Como √© privado, n√£o ser√° poss√≠vel alterar tal inst√¢ncia depois de o atributo ter sido inicializado.
- Deve existir um m√©todo `getInstance()` que deve verificar se um objeto j√° foi criado e apenas retorn√°-lo. Caso contr√°rio, um novo objeto deve ser criado e armazenado no atributo est√°tico comentado no item acima.

== Padr√µes Relacionados

Padr√µes que possuem similaridades ou podem ser usados em conjunto:

- link:../factory-method[Factory Method]

== Onde o padr√£o √© usado no JDK

- java.awt.Desktop
- java.lang.Runtime
